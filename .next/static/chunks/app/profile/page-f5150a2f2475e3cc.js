(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{489:(e,s,t)=>{"use strict";t.d(s,{b:()=>n});var r=t(2115),a=t(7602),i=t(5155),l=r.forwardRef((e,s)=>(0,i.jsx)(a.sG.label,{...e,ref:s,onMouseDown:s=>{var t;s.target.closest("button, input, select, textarea")||(null==(t=e.onMouseDown)||t.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));l.displayName="Label";var n=l},2944:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>B});var r=t(5155),a=t(2115),i=t(5239),l=t(6072),n=t(1335),d=t(3998),o=t(5897),c=t(6948),m=t(4585),h=t(9708),x=t(6633),u=t(243),p=t(3664),j=t(6485),f=t(7772),v=t(3457),g=t(5937),N=t(9652),b=t(235),k=t(7181),w=t(3298),y=t(5894),C=t(4269),E=t(9041),A=t(1834),S=t(5142),P=t(6444),$=t(1120),_=t(5299);function M(e){let{isOpen:s,setIsOpen:t,profile:i,onProfileUpdate:l}=e,{user:n}=(0,x.A)(),{toast:o}=(0,y.dj)(),[c,u]=(0,a.useState)(""),[p,j]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[g,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{i&&(u(i.name||""),j(i.username||""),v(i.bio||""))},[i]);let b=async()=>{if(!n)return void o({title:"Not Authenticated",description:"You must be logged in to edit your profile.",variant:"destructive"});if(!c.trim()||!p.trim())return void o({title:"Missing Fields",description:"Name and username are required.",variant:"destructive"});N(!0);try{let e=(0,h.H9)(m.db,"users",n.uid),s={name:c,username:p,bio:f};await (0,h.mZ)(e,s),l({...i,...s}),o({title:"Profile Updated",description:"Your changes have been saved."}),t(!1)}catch(e){console.error("Error updating profile:",e),o({title:"Error",description:"Could not update your profile. Please try again.",variant:"destructive"})}finally{N(!1)}};return(0,r.jsx)(A.lG,{open:s,onOpenChange:t,children:(0,r.jsxs)(A.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(A.c7,{children:[(0,r.jsx)(A.L3,{children:"Edit Profile"}),(0,r.jsx)(A.rr,{children:"Make changes to your profile here. Click save when you're done."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(P.J,{htmlFor:"name",className:"text-right",children:"Name"}),(0,r.jsx)(S.p,{id:"name",value:c,onChange:e=>u(e.target.value),className:"col-span-3"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(P.J,{htmlFor:"username",className:"text-right",children:"Username"}),(0,r.jsx)(S.p,{id:"username",value:p,onChange:e=>j(e.target.value),className:"col-span-3"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,r.jsx)(P.J,{htmlFor:"bio",className:"text-right pt-2",children:"Bio"}),(0,r.jsx)($.T,{id:"bio",value:f,onChange:e=>v(e.target.value),className:"col-span-3"})]})]}),(0,r.jsxs)(A.Es,{children:[(0,r.jsx)(A.HM,{asChild:!0,children:(0,r.jsx)(d.$,{type:"button",variant:"secondary",children:"Cancel"})}),(0,r.jsxs)(d.$,{onClick:b,disabled:g,children:[g&&(0,r.jsx)(_.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})}var I=t(6767);function D(){return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"h-48 bg-muted"}),(0,r.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"-mt-16 sm:-mt-24 sm:flex sm:items-end sm:space-x-5",children:[(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)(u.E,{className:"h-32 w-32 rounded-full ring-4 ring-background"})}),(0,r.jsx)("div",{className:"mt-6 sm:flex-1 sm:min-w-0 sm:flex sm:items-center sm:justify-end sm:space-x-6 sm:pb-1",children:(0,r.jsxs)("div",{className:"mt-6 min-w-0 flex-1 sm:hidden md:block",children:[(0,r.jsx)(u.E,{className:"h-7 w-48"}),(0,r.jsx)(u.E,{className:"mt-2 h-4 w-32"})]})})]}),(0,r.jsxs)("div",{className:"mt-6 hidden min-w-0 flex-1 sm:block md:hidden",children:[(0,r.jsx)(u.E,{className:"h-7 w-48"}),(0,r.jsx)(u.E,{className:"mt-2 h-4 w-32"})]}),(0,r.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,r.jsx)(u.E,{className:"h-4 w-full"}),(0,r.jsx)(u.E,{className:"h-4 w-3/4"})]}),(0,r.jsxs)("div",{className:"mt-4 flex space-x-4",children:[(0,r.jsx)(u.E,{className:"h-4 w-24"}),(0,r.jsx)(u.E,{className:"h-4 w-24"})]})]})]})}function B(){var e;let{user:s}=(0,x.A)(),{toast:t}=(0,y.dj)(),[u,A]=(0,a.useState)([]),[S,P]=(0,a.useState)(!0),[$,_]=(0,a.useState)(null),[B,U]=(0,a.useState)(null),[J,O]=(0,a.useState)(new Set),[Z,F]=(0,a.useState)(new Set),[L,z]=(0,a.useState)({}),[H,R]=(0,a.useState)(!1),Y=(0,a.useCallback)(()=>{var e;return s?{uid:s.uid,name:s.displayName||"Cinephile",username:(null==(e=s.email)?void 0:e.split("@")[0])||"user_".concat(s.uid.substring(0,5)),email:s.email,bio:"Movie enthusiast. Critic in the making. Follow me for hot takes on the latest flicks.",profilePicture:s.photoURL||"https://picsum.photos/seed/".concat(s.uid,"/400/400"),followers:[],following:[],createdAt:{toDate:()=>new Date}}:null},[s]);(0,a.useEffect)(()=>{if(!s)return;(async()=>{P(!0);try{let e=(0,h.H9)(m.db,"users",s.uid),t=await (0,h.x7)(e);if(t.exists())_({...t.data(),id:t.id});else{let s=Y();s&&(await (0,h.BN)(e,{...s,createdAt:(0,h.O5)()}),_(s))}}catch(e){console.error("Error fetching user profile:",e),t({title:"Offline Mode",description:"Could not load full profile. Displaying local data.",variant:"default"}),$||_(Y())}finally{P(!1)}})();let e=(0,h.P)((0,h.rJ)(m.db,"posts"),(0,h._M)("author.uid","==",s.uid),(0,h.My)("timestamp","desc")),r=(0,h.aQ)(e,e=>{A(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{console.error("Error fetching posts:",e),t({title:"Error",description:"Could not fetch your posts.",variant:"destructive"})}),a=(0,h.rJ)(m.db,"users",s.uid,"bookmarks"),i=(0,h.P)(a,(0,h._M)("type","==","post")),l=(0,h.aQ)(i,e=>{let s={};e.forEach(e=>{s[e.data().originalPostId]=e.id}),z(s)},()=>{console.warn("Could not fetch bookmarks, you may be offline.")});return()=>{r(),l()}},[s,t,Y,$]);let q=(e,s,t,r)=>{if("comment"===s)return void U(e);if(t&&r){let a=new Set(t),i=a.has(e.id);i?a.delete(e.id):a.add(e.id),r(a),A(t=>t.map(t=>{if(t.id===e.id){let e="like"===s?"likes":"retweets";return{...t,[e]:t[e]+(i?-1:1)}}return t}))}},T=async e=>{if(!s)return void t({title:"Not logged in",description:"You need to be logged in to bookmark posts.",variant:"destructive"});let r=L[e.id];if(r)try{await (0,h.kd)((0,h.H9)(m.db,"users",s.uid,"bookmarks",r)),t({title:"Post Removed from Bookmarks",description:"It has been removed from your collection."})}catch(e){console.error("Error removing bookmark:",e),t({title:"Error",description:"Could not remove the post from your bookmarks.",variant:"destructive"})}else try{let r=(0,h.rJ)(m.db,"users",s.uid,"bookmarks"),a={name:e.author.name,username:e.author.username,avatarUrl:e.author.avatarUrl||""};await (0,h.gS)(r,{type:"post",originalPostId:e.id,author:a,content:e.content,timestamp:(0,w.m)(e.timestamp.toDate())+" ago",bookmarkedAt:h.Dc.now()}),t({title:"Post Bookmarked!",description:"It has been added to your collection."})}catch(e){console.error("Error bookmarking post:",e),t({title:"Error",description:"Could not bookmark the post.",variant:"destructive"})}};return(0,r.jsxs)(l.AppLayout,{rightSidebar:(0,r.jsx)(n.J,{}),children:[B&&(0,r.jsx)(E._,{isOpen:!!B,setIsOpen:e=>!e&&U(null),post:B,onCommentSuccess:()=>{A(e=>e.map(e=>e.id===B.id?{...e,comments:e.comments+1}:e))}}),$&&(0,r.jsx)(M,{isOpen:H,setIsOpen:R,profile:$,onProfileUpdate:e=>{_(e)}}),S?(0,r.jsx)(D,{}):$?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"pb-4",children:[(0,r.jsx)("div",{className:"h-48 bg-muted relative",children:(0,r.jsx)(i.default,{src:"https://picsum.photos/1500/500",alt:"Profile banner",fill:!0,className:"object-cover","data-ai-hint":"header background"})}),(0,r.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-end -mt-16 sm:-mt-20",children:[(0,r.jsxs)(o.eu,{className:"h-32 w-32 rounded-full ring-4 ring-background shrink-0 border-2 border-background",children:[(0,r.jsx)(o.BK,{src:$.profilePicture,alt:$.name}),(0,r.jsx)(o.q5,{children:null==(e=$.name)?void 0:e.charAt(0)})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 pb-2",children:[(0,r.jsx)(I.Bc,{children:(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsx)(d.$,{variant:"outline",size:"icon",children:(0,r.jsx)(p.A,{className:"h-4 w-4"})})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Message"})})]})}),(0,r.jsx)(d.$,{onClick:()=>R(!0),children:"Edit Profile"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h1",{className:"truncate text-2xl font-bold text-foreground",children:$.name}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["@",$.username]})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:$.bio})}),(0,r.jsxs)("div",{className:"mt-4 flex items-center space-x-4 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.A,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Joined ",$.createdAt?new Date($.createdAt.toDate()).toLocaleDateString("en-US",{month:"long",year:"numeric"}):""]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"font-bold text-foreground",children:"1.2k"})," Following"]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"font-bold text-foreground",children:"5.8k"})," Followers"]})]})]})]}),(0,r.jsx)("div",{className:"border-t border-border",children:u.length>0?u.map(e=>{let s=J.has(e.id),a=Z.has(e.id),l=!!L[e.id];return(0,r.jsx)(c.Zp,{className:"border-x-0 border-b border-t-0 rounded-none hover:bg-accent/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex gap-4 p-4",children:[(0,r.jsxs)(o.eu,{children:[(0,r.jsx)(o.BK,{src:e.author.avatarUrl,alt:e.author.name}),(0,r.jsx)(o.q5,{children:e.author.name.charAt(0)})]}),(0,r.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsx)("p",{className:"font-semibold hover:underline cursor-pointer",children:e.author.name}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["@",e.author.username," \xb7 ",e.timestamp?(0,w.m)(e.timestamp.toDate())+" ago":"just now"]})]}),(0,r.jsx)(I.Bc,{children:(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsx)(d.$,{variant:"ghost",size:"icon",className:"w-8 h-8 -mr-2 -mt-2",children:(0,r.jsx)(f.A,{className:"h-5 w-5"})})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"More"})})]})})]}),(0,r.jsx)("p",{className:"whitespace-pre-wrap py-2",children:e.content}),e.imageUrl&&(0,r.jsx)(c.Wu,{className:"p-0 pt-3",children:(0,r.jsx)("div",{className:"relative aspect-[16/9] rounded-lg overflow-hidden border border-border",children:(0,r.jsx)(i.default,{src:e.imageUrl,alt:"Post image",fill:!0,className:"object-cover","data-ai-hint":e.imageHint})})}),(0,r.jsx)(c.wL,{className:"p-0 pt-3 flex justify-around -ml-2",children:(0,r.jsxs)(I.Bc,{children:[(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsxs)(d.$,{variant:"ghost",size:"sm",className:(0,C.cn)("flex items-center gap-2 text-muted-foreground hover:text-red-500",s&&"text-red-500"),onClick:()=>q(e,"like",J,O),children:[(0,r.jsx)(v.A,{className:(0,C.cn)("h-5 w-5",s&&"fill-current")}),(0,r.jsx)("span",{className:"text-xs",children:e.likes})]})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Like"})})]}),(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsxs)(d.$,{variant:"ghost",size:"sm",className:"flex items-center gap-2 text-muted-foreground hover:text-primary",onClick:()=>q(e,"comment"),children:[(0,r.jsx)(g.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"text-xs",children:e.comments})]})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Comment"})})]}),(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsxs)(d.$,{variant:"ghost",size:"sm",className:(0,C.cn)("flex items-center gap-2 text-muted-foreground hover:text-green-500",a&&"text-green-500"),onClick:()=>q(e,"retweet",Z,F),children:[(0,r.jsx)(N.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"text-xs",children:e.retweets})]})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Retweet"})})]}),(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsx)(d.$,{variant:"ghost",size:"sm",className:(0,C.cn)("flex items-center gap-2 text-muted-foreground hover:text-primary",l&&"text-primary"),onClick:()=>T(e),children:(0,r.jsx)(b.A,{className:(0,C.cn)("h-5 w-5",l&&"fill-current")})})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Bookmark"})})]}),(0,r.jsxs)(I.m_,{children:[(0,r.jsx)(I.k$,{asChild:!0,children:(0,r.jsx)(d.$,{variant:"ghost",size:"sm",className:"flex items-center gap-2 text-muted-foreground hover:text-primary",onClick:()=>{var s;return s=e.id,void(navigator.clipboard.writeText("".concat(window.location.origin,"/post/").concat(s)),t({title:"Link Copied!",description:"The post link has been copied to your clipboard."}))},children:(0,r.jsx)(k.A,{className:"h-5 w-5"})})}),(0,r.jsx)(I.ZI,{children:(0,r.jsx)("p",{children:"Share"})})]})]})})]})]})},e.id)}):(0,r.jsxs)("div",{className:"text-center p-8 text-muted-foreground",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"You haven't posted anything yet"}),(0,r.jsx)("p",{children:"When you post, it'll show up here."})]})})]}):(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)("p",{children:"Could not load profile."})})]})}},6079:(e,s,t)=>{Promise.resolve().then(t.bind(t,2944))},6444:(e,s,t)=>{"use strict";t.d(s,{J:()=>o});var r=t(5155),a=t(2115),i=t(489),l=t(3101),n=t(4269);let d=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(i.b,{ref:s,className:(0,n.cn)(d(),t),...a})});o.displayName=i.b.displayName},6485:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(1847).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])}},e=>{e.O(0,[9135,3965,5031,6900,2494,988,2619,6434,3298,6072,8200,8441,1255,7358],()=>e(e.s=6079)),_N_E=e.O()}]);